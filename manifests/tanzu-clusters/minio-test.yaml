apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: minio-test-pvc
  namespace: tanzuns1
spec:
  accessModes:
  - ReadWriteOnce
  resources:
    requests:
      storage: 190Gi
  storageClassName: tanzu
  volumeMode: Filesystem
---
apiVersion: vmoperator.vmware.com/v1alpha1
kind: VirtualMachine
metadata:
  labels:
    vm-selector: minio-test-vm
  name: minio-test-vm
  namespace: tanzuns1
spec:
  imageName: centos-stream-8-vmservice-v1alpha1-1619529007339
  className: best-effort-medium
  powerState: poweredOn
  storageClass: tanzu
  networkInterfaces:
  - networkType: nsx-t
    networkName: ""
  volumes:
  - name: minio-test-vol
    persistentVolumeClaim:
      claimName: minio-test-pvc
  readinessProbe:
    tcpSocket:
      port: 22
  vmMetadata:
    configMapName: minio-test-cloudinit
    transport: OvfEnv
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: minio-test-cloudinit
  namespace: tanzuns1
data:
  user-data: I2Nsb3VkLWNvbmZpZwpjaHBhc3N3ZDoKICAgIGxpc3Q6IHwKICAgICAgY2VudG9zOlZNd2FyZTEhCiAgICBleHBpcmU6IGZhbHNlCmdyb3VwczoKICAtIGRvY2tlcgp1c2VyczoKICAtIGRlZmF1bHQKICAtIG5hbWU6IGNlbnRvcwogICAgc3NoLWF1dGhvcml6ZWQta2V5czoKICAgICAgLSBzc2gtcnNhIEFBQUFCM056YUMxeWMyRUFBQUFEQVFBQkFBQUNBUURTd3lGKzZLSE9DaittbkhnZndMYUNYZ1pjSnJ4NnNhdFVITnN1YXdZZU5IQ2dxY1ZCZ0xYbXJ2dFRRdVVjTGpCVGczYjNNdmw4c1ZqTTZnV0Jya3VKZENBZkZ2R3FUdTdqaUNwUHV0OHBKaW9NcXVhcnJxbThsTUJRTEZUS0JQL2t6R2ZQbmYydTRwdnhxNzRvZ1pTSUpUcnF2cnNvWm9vcjQzVTNOczhyU0lNUDgzNUtPWURZU1l4SnFDcVBPYW9McG5QSThxMC80U2hneFRTbXIwd2crRG10emIxc1c5ZTQyYW9SSndlMkttck83VW91S283dXhJdVVTbUp4OVZzVThGK3VCTERVTUlFNWZTZ0ZTcWFuYkZjZ1l0K3RwSHRsL1h2VUwxdjY3cEJYb2pxTVNvZWhUY2dDQTlDVlA5R3B1bWpieFI5SlEwd3dIRUxlYU4rNlJDNzNoN0RLK0pXWWZVK0ZPai94ZkZEcmhkQ3pKRzh3ZWhIU0dESFVOTkNCcWpFSStvekxvVEExYk5sQXFXUFVJNXJscnFiN3ZKSzlyY1RIcm5RZjZubGpyL1JmUzhZOUtwTEMzaXFMT08xd0tvMFd3UGFZZFJMZ0lFQkNMam4vOElteDNndjFzaDd6dEhUWWJpNlRJYVFJUzZxVFhRNGQwc3J0d2tsZFFHaXZKOU5yd3ZzeXR0b2Y5bGtUcHRZSlVlTlUyMjMxekJwSGNReE5vQ2JtUHlpMHlmZm9BSnEvQUh0SUxLS0N2K3FNN0U4dTZ0Wkx2SzhSNFFnd3B1MTFpTHJaTmQzUEFUU0xMM2Y0WWJXdk9uejJGMWVTVUlQTk4wSzI0Q2ZMc1oxVnZIRWhQZ2wrRzJHSytYMVdVcEJ1Q3NDbHZtSjBXdDFaOEtLUS9yM1I3dz09IGdvcmtlbW9Adm13YXJlLmNvbQogICAgc3VkbzogQUxMPShBTEwpIE5PUEFTU1dEOkFMTAogICAgZ3JvdXBzOiBzdWRvLCBkb2NrZXIKICAgIHNoZWxsOiAvYmluL2Jhc2gKbmV0d29yazoKICB2ZXJzaW9uOiAyCiAgZXRoZXJuZXRzOgogICAgICBlbnMxOTI6CiAgICAgICAgICBkaGNwNDogdHJ1ZQpwYWNrYWdlX3VwZGF0ZTogdHJ1ZQp5dW1fcmVwb3M6CiAgZG9ja2VyLWNlLXN0YWJsZToKICAgIG5hbWU6IERvY2tlciBDRSBTdGFibGUgLSAkYmFzZWFyY2gKICAgIGJhc2V1cmw6IGh0dHBzOi8vZG93bmxvYWQuZG9ja2VyLmNvbS9saW51eC9jZW50b3MvJHJlbGVhc2V2ZXIvJGJhc2VhcmNoL3N0YWJsZQogICAgZW5hYmxlZDogdHJ1ZQogICAgZ3BnY2hlY2s6IHRydWUKICAgIGdwZ2tleTogaHR0cHM6Ly9kb3dubG9hZC5kb2NrZXIuY29tL2xpbnV4L2NlbnRvcy9ncGcKbW91bnRzOgogIC0gWyAvZGV2L3NkYjEsIC9kYXRhLCAieGZzIiwgImRlZmF1bHRzIiwgIjAiLCAiMiIgXQpwYWNrYWdlczoKICAtIG5ldC10b29scwogIC0gd2dldAp3cml0ZV9maWxlczoKICAtIHBhdGg6IC9vcHQvbWluaW8vbWluaW8uY29uZgogICAgY29udGVudDogfAogICAgICBNSU5JT19WT0xVTUVTPS9kYXRhL21pbmlvL2RhdGEKICAgICAgTUlOSU9fUk9PVF9VU0VSPW1pbmlvCiAgICAgIE1JTklPX1JPT1RfUEFTU1dPUkQ9bWluaW8xMjMKICAgIG93bmVyOiAncm9vdDpyb290JwogICAgcGVybWlzc2lvbnM6ICcwNDQ0JwogIC0gcGF0aDogL2V0Yy9zeXN0ZW1kL3N5c3RlbS9taW5pby5zZXJ2aWNlCiAgICBjb250ZW50OiB8CiAgICAgIFtVbml0XQogICAgICBEZXNjcmlwdGlvbj1NaW5pbwogICAgICBEb2N1bWVudGF0aW9uPWh0dHBzOi8vZG9jcy5taW5pby5pbwogICAgICBXYW50cz1uZXR3b3JrLW9ubGluZS50YXJnZXQKICAgICAgQWZ0ZXI9bmV0d29yay1vbmxpbmUudGFyZ2V0CiAgICAgIEFzc2VydEZpbGVJc0V4ZWN1dGFibGU9L29wdC9taW5pby9iaW4vbWluaW8KICAgICAgCiAgICAgIFtTZXJ2aWNlXQogICAgICBXb3JraW5nRGlyZWN0b3J5PS9vcHQvbWluaW8KICAgICAgCiAgICAgIFVzZXI9cm9vdAogICAgICBHcm91cD13aGVlbAogICAgICAKICAgICAgUGVybWlzc2lvbnNTdGFydE9ubHk9dHJ1ZQogICAgICAKICAgICAgRW52aXJvbm1lbnRGaWxlPS0vb3B0L21pbmlvL21pbmlvLmNvbmYKICAgICAgRXhlY1N0YXJ0UHJlPS9iaW4vYmFzaCAtYyAiWyAtbiBcIiR7TUlOSU9fVk9MVU1FU31cIiBdIHx8IGVjaG8gXCJWYXJpYWJsZSBNSU5JT19WT0xVTUVTIG5vdCBzZXQgaW4gL29wdC9taW5pby9taW5pby5jb25mXCIiCiAgICAgIAogICAgICBFeGVjU3RhcnQ9L29wdC9taW5pby9iaW4vbWluaW8gc2VydmVyICRNSU5JT19PUFRTIC0tYWRkcmVzcyAwLjAuMC4wOjkwMDAgLS1jb25zb2xlLWFkZHJlc3MgMC4wLjAuMDo5MDAxICRNSU5JT19WT0xVTUVTCiAgICAgIAogICAgICBTdGFuZGFyZE91dHB1dD1qb3VybmFsCiAgICAgIFN0YW5kYXJkRXJyb3I9aW5oZXJpdAogICAgICAKICAgICAgIyBTcGVjaWZpZXMgdGhlIG1heGltdW0gZmlsZSBkZXNjcmlwdG9yIG51bWJlciB0aGF0IGNhbiBiZSBvcGVuZWQgYnkgdGhpcyBwcm9jZXNzCiAgICAgIExpbWl0Tk9GSUxFPTY1NTM2CiAgICAgIAogICAgICAjIERpc2FibGUgdGltZW91dCBsb2dpYyBhbmQgd2FpdCB1bnRpbCBwcm9jZXNzIGlzIHN0b3BwZWQKICAgICAgVGltZW91dFN0b3BTZWM9MAogICAgICAKICAgICAgIyBTSUdURVJNIHNpZ25hbCBpcyB1c2VkIHRvIHN0b3AgTWluaW8KICAgICAgS2lsbFNpZ25hbD1TSUdURVJNCiAgICAgIAogICAgICBTZW5kU0lHS0lMTD1ubwogICAgICAKICAgICAgU3VjY2Vzc0V4aXRTdGF0dXM9MAogICAgICAKICAgICAgW0luc3RhbGxdCiAgICAgIFdhbnRlZEJ5PW11bHRpLXVzZXIudGFyZ2V0CiAgICBvd25lcjogcm9vdDpyb290CiAgICBwZXJtaXNzaW9uczogJzA2NDQnCnJ1bmNtZDoKICAtIHBhcnRlZCAvZGV2L3NkYiBta2xhYmVsIGdwdAogIC0gcGFydGVkIC9kZXYvc2RiIG1rcGFydCBwcmltYXJ5IHhmcyAxTUIgMTk0NTYwTUIKICAtIC9zYmluL21rZnMueGZzIC9kZXYvc2RiMQogIC0gbWtkaXIgLXAgL2RhdGEKICAtIG1vdW50IC10IHhmcyAtLXJ3IC9kZXYvc2RiMSAvZGF0YQogIC0gbWtkaXIgLXAgL29wdC9taW5pby9iaW4KICAtIG1rZGlyIC1wIC9kYXRhL21pbmlvL2RhdGEKICAtIHdnZXQgLXEgaHR0cHM6Ly9kbC5taW5pby5pby9zZXJ2ZXIvbWluaW8vcmVsZWFzZS9saW51eC1hbWQ2NC9taW5pbyAtTyAvb3B0L21pbmlvL2Jpbi9taW5pbwogIC0gY2htb2QgK3ggL29wdC9taW5pby9iaW4vbWluaW8KICAtIHN5c3RlbWN0bCBkYWVtb24tcmVsb2FkCiAgLSBzeXN0ZW1jdGwgZW5hYmxlIG1pbmlvCiAgLSBzeXN0ZW1jdGwgc3RhcnQgbWluaW8KICAtIHN5c3RlbWN0bCBzdG9wIGZpcmV3YWxsZAogIC0gc3lzdGVtY3RsIGRpc2FibGUgZmlyZXdhbGxkCgo=
  hostname: minio-test-vm
---
apiVersion: vmoperator.vmware.com/v1alpha1
kind: VirtualMachineService
metadata:
  name: minio-test-svc
  namespace: tanzuns1
spec:
  ports:
  - name: ssh
    port: 22
    protocol: TCP
    targetPort: 22
  - name: secure
    port: 443
    protocol: TCP
    targetPort: 443
  - name: minio
    port: 9000
    protocol: TCP
    targetPort: 9000
  - name: console
    port: 9001
    protocol: TCP
    targetPort: 9001
  selector:
    vm-selector: minio-test-vm
  type: LoadBalancer
